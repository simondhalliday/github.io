---
title: "CVC Workshop Notes"
author: "Simon Halliday"
date: "2015-July -13"
output: 
  html_document:
    css: ../stylesheets/styles.css

---

## Introduction to R and R studio
Scatterplot with birth data:
```{r, message = FALSE}
library(mosaic)
library(mosaicData)
xyplot(births ~ dayofyear, data = Births78)

```


Other commands we've run during the workshop day 1 and some comments on them. 
```{r}
histogram(~ age, data = HELPrct) #histogram of age
favstats(~ age, data = HELPrct) #My favorite statistics; it ignores NAs
tally(~sex, data = HELPrct) #Count of gender
tally(~sex, format = "percent", data = HELPrct) #Percents of gender
tally(~sex, format = "proportion", data = HELPrct) #Proportions of gender
tally(~substance, data = HELPrct) #Count of substance
tally(~substance, format = "perc", data = HELPrct) #Percents of substance
tally(sex ~ substance, data = HELPrct) #Cross-tab sex & substance
tally(~ sex + substance, data = HELPrct) #Ditto, just a different format
```

Also, always remember the `mplot` command for producing graphs and clicking on the 'Show Expression'. 

## Data Structures and Tidy Data

Consider cases and variables

* a __row__ is always a __case__
* a __column__ is always a __variable__ 

In tidy data: 

* No units
* No footnotes

All of this goes into a codebook only. 




## Visualizing Data

DTK:
* Glyphs are marks; data glyps are also marks and the features of the glyphs encode the values of the variables & the visual properties are aesthetics. The choices that we make as experts in our field is the choice of aesthetic to map to variables. The word 'aesthetic' here is taken from its early 
*When we make data glyps we map variables to aesthetics. 
*A scale is for a computer and a guide is for a person (about the aesthetics). A legend (beside a graph) is an example of a guide. 
*A data table is glyph-ready when there is one row for each glyp to be drawn (I could say, "that's x-position, that's y-position, that's color, that's size." 
* Glyph-ready data are tidy data, but tidy data are not necessarily glyph-ready.
*Sometimes glyphs represent the collective properties of variables, e.g. in the case of histograms. 

RP: 

* Teaches going from the histogram back to the data, rather than going from the data to the histogram because of having had the experience of studnets rote learning to go from data to a histogram without actually understanding what histograms mean. 

```{r, message = FALSE}
require(lubridate)
data(Births78)
head(Births78, 3)
```

* We want to generate a plot using `ggplot() + geom_point()`
* We also need aesthetics, `aes()`, e.g. `aes(x = date, y = births)`
* And a call on the data, data = Births78

```{r}
ggplot(data = Births78, aes(x = date, y = births)) + geom_point()
```
But, we need to add days of the week because that's more useful to us: 
```{r}
Births78 <- 
  Births78 %>% 
  mutate(wday = wday(date, label = TRUE))
  ggplot(data = Births78, aes(x = date, y = births, color = wday)) + geom_point() 
```
Note, that the same graph would be generated by the following: 
```{r}
  ggplot(data = Births78) + geom_point(aes(x = date, y = births, color = wday)) 
```

We could change this to a line graph: 
```{r}
 ggplot(data = Births78) + geom_line(aes(x = date, y = births, color = wday)) 
```

Or we could have points and lines; note that we have _moved_ the `aes` commands into the `ggplot` command because it applies to _all_ the layers. 
```{r}
 ggplot(data = Births78, aes(x = date, y = births, color = wday)) + geom_line() + geom_point()
```
We could have put the data outside the ggplot command using the magrittr pipe: 
```{r}
 Births78 %>%
  ggplot(aes(x = date, y = births, color = wday)) + geom_line() + geom_point()
```

We need to do setting rather than mapping for things like colors; inside the individual geom you __set__ the color you want (*different to ggvis* where setting is done with `:=`). Within ggplot you can _only_ __map__ nor __set__. 
```{r}
 Births78 %>%
  ggplot(aes(x = date, y = births)) + geom_point(color = "navy")
```

Combine the colored lines with navy points - notice that `wday` is in the  `aes` in the `geom_line` whereas with `geom_point` we don't call on `aes` because we're simply setting (not mapping).
```{r}
 Births78 %>%
  ggplot(aes(x = date, y = births)) + 
    geom_line(aes(color = wday)) + 
    geom_point(color = "navy")
```
Recall that we can check out the kinds of geoms that exist if we use the command `apropos`, notice the use of the caret (`^`)
```{r}
apropos("^geom")
```

* Key plot metric: Does my plot make the comparisions I am
interested in __easily__ and __accurately__. 

* We can generate a new geom, a `geom_bar`: 

```{r}
HELPrct %>% 
ggplot(aes(x = substance)) + 
geom_bar()
```
Notice that we were able to construct the bar chart even though our data weren't glyph-ready with counts; ggplot did it for us. 

* We want to generate histograms where we can __set__ the binwidth:

```{r}
HELPrct %>% 
    ggplot(aes(x = age)) + 
    geom_histogram(binwidth = 2)
```
* We also often want to use frequency polygons or kernel density functions:

```{r}
HELPrct %>% 
ggplot(aes(x = age)) + 
    geom_freqpoly(binwidth = 2)
```

```{r}
HELPrct %>% 
ggplot(aes(x = age)) + 
    geom_density()
```

But, note RP prefers to add density to a line plot because it look
```{r}
HELPrct %>% 
ggplot(aes(x = age)) + 
geom_line(stat = "density")
```

Or we could have put the geom in the stat_density

```{r}
HELPrct %>%
ggplot(aes(x=age)) +
stat_density( geom="line")
```

Now generate your own graph looking at the average consumption of graphs (which I did by groups)
```{r}
HELPrct %>% 
    ggplot(aes(x = i1)) + 
    geom_line(stat = "density", aes(color = factor(substance)))
```



##Teaching Tips
These are tips I picked out (thus idiosyncratic):

* __For teaching the idea of the command line and the script:__ How many of you had a [TI calculator](https://en.wikipedia.org/wiki/Comparison_of_Texas_Instruments_graphing_calculators)? (TI = Texas Instruments; I did not know this abbreviation -- like the international students) Did you know how to use it on the very first day? What about on your final day of high school? (RP)
* When R outputs the error `object '[object name]' not found` that normally means you (or your student) have mis-spelt the variable name or dataframe name. (RP)
* Pick your favorite way (command) for doing a job, don't show students too many methods. You'll overwhelm them if you give them too much. __Less volume, more creativity__. (RP)
* Call tildes `~` 'wiggles'! Sounds funny and is less scary then tilde. (RP) 
* Two most important questions: What do you want R to do? (goal) What must R know to do that? (RP) [me - why don't I call R a specific name? e.g. R = Rachel - What do I want Rachel to do? What must Rachel know to do that?]
* Don't teach them all the bells & whistles in a lecture when _you_ want it. Rather, do it when they ask. (RP)
* Get students to adopt a __workflow__ such that students can reproduce their work again with new data. (NH) 
* When you start a new Markdown file (Rmd), it means that you need to load each package in the Rmd file. Often it's useful to do so with the message include = FALSE to suppress the inclusion of that code in the output file. 
* Students struggle to understand the ecological paradox (relating to the fallacy of division; which is the complement of the fallacy of composition).
* RP names dataframes with uppercase letters and variables with lowercase letters (unless the variables are a well known acronym)




## Commonplace Book

* RP: "If your students find R to be the hardest part of your course, your R is too hard and your questions are too easy."
* RP: "You need to learn to see before you can see to learn." (As advice to professors to get them over the problem of assumed prior learning)
* 



### Working with some of my own data

```{r}

```


Importing the medicare data... 
```{r}
#medicare <- read.csv("/Users/shalliday/Google Drive/simondhalliday.github.io/cvc_workshop/medicare_fy2013.csv")
medicare <- read.csv("medicare_fy2013.csv")
#head(medicare)
#str(medicare)
```




Trying to embed a badly thought-out plot using the `ggvis` package:

```{r, message = FALSE}
library(dplyr)
library(ggvis)
medicare %>% 
  ggvis(~factor(Provider.State), ~Average.Covered.Charges) %>%
  layer_bars() %>%
   add_axis("x", properties = axis_props(
    labels = list(angle = 45, align = "left", fontSize = 10)
   ))

```


