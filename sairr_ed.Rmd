---
title: "SAIRR Check"
author: "Simon Halliday"
date: "2017-June -25"
output: oilabs::lab_report
bibliography: uct/sairr_bib.bib
---

```{r setup, include = FALSE, message = FALSE, warnings = FALSE}
library(tidyverse)
library(mosaic)
library(knitr)
```

##Intro
I saw the report by @sairr17 and used by a friend in a Facebook discussion (you can get the report [here](http://sa-monitor.com/wp-content/uploads/2017/02/IRR-Auditing-racial-transformation-2017-01.pdf)). I didn't believe the numbers he cited from the report, so I wanted to download the data and check them. The main data are from @ghs2015. I use packages by @tidyverse2017 and @oilabs2016 for ease in this doc. Note, this isn't meant to be a comprehensive fact check, just me not sure about numbers a friend was citing. 


##Data
The data can be obtained here: [microdata.worldbank.org/index.php/catalog/2773/related_materials](http://microdata.worldbank.org/index.php/catalog/2773/related_materials). 

Import the data csv of the GHS 2015:
```{r data_import, warnings = FALSE, message = FALSE}
ghs15 <- read_csv("uct/csv/ghs_2015_person_v1.1_20160608.csv")
```

##Wrangling 
Wrangle the data and select the sample of 20 and older. 
Generate a variable that checks the proportion of people of each race that has Matric or higher. 
Also try to find out their error with another variable. 
Couldn't quite get the same proportions they did, but I wasn't trying too hard. 
```{r}
educ20 <- 
  ghs15 %>%
  filter(Age > 19) %>%
  mutate(matricmore = ifelse(Q15HIEDU %in% c(12, 13, 16,
                                             17, 18, 19,
                                             21, 22, 23,
                                             24, 25, 26,
                                             27, 28, 29),
                             1, 0), 
         matriconly = ifelse(Q15HIEDU %in% c(12, 13, 23)
                             , 1, 0), 
         race = factor(race, labels = c("Black/African",
                                        "Coloured",
                                        "Indian/Asian",
                                        "White")))
```

##Summary Stats
Generate summary data frame. 
Note: I haven't used the sampling weights here because I haven't had the time to research them, they shouldn't change the estimates too much just yet. 
```{r}
raceSum <- 
  educ20 %>%
  group_by(race) %>%
  summarise(matricprop = round(mean(matricmore), 3))
kable(raceSum, col.names = c("Race", "Proportion with at least Grade 12"))
```

##Other tallies
Screwing around with some other tallies to check my work above. 
```{r}
mosaic::tally(~Q15HIEDU, data = educ20)
mosaic::tally(~race, data = educ20)
mosaic::tally(~matricmore, data = educ20)
mosaic::tally(~matricmore | race, data = educ20, format = "percent")
```

##License
<a rel="license" href="http://creativecommons.org/licenses/by-nc/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-nc/4.0/88x31.png" /></a><br />This work is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-nc/4.0/">Creative Commons Attribution-NonCommercial 4.0 International License</a>.


##References
